# This CodeBuild specification file dereferences a JSON Draft Schema file
# and produces, as an artifact the output file. By default, this build
# file is used to compile your pipeline and services templates.
#
# This file enables you to define service and build pipelines, by incorporating
# common & shared snippets of AWS Cloudformation. You can reference snippet files
# in their entirety, or specific definitions inside each snippet, using JSON Refs
# as described in the below example:
#
#  MyResource:
#    $ref: "s3://snippets/parameters/basic.yml#/Branch"
#
# WARNING: Unless you need custom behavior for your pre-processing step, you
# should avoid modifying this file. It is present inside your repository to
# provide you with added flexibility should you need it.
version: 0.1

phases:
  pre_build:
    commands:
      - echo "Installing JSON Dereference CLI..."
      - npm install -g json-dereference-cli

      - echo "Creating Artifacts Directory..."
      - mkdir artifacts

  build:
    commands:
      - echo "Dereferencing Schema..."
      - json-dereference -s $SCHEMA -o artifacts/$SCHEMA -b $SNIPPETS

artifacts:
  type: zip
  discard-paths: yes
  files:
    - artifacts/**/*
